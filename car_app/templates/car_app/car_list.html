{% extends 'base.html' %}

{% block title %}ุงูุณูุงุฑุงุช - ูุธุงู ุฅุฏุงุฑุฉ ุงูุณูุงุฑุงุช{% endblock %}

{% block content %}
<div class="d-flex justify-between align-center mb-3" style="flex-wrap: wrap; gap: 1rem;">
    <h1>ุฅุฏุงุฑุฉ ุงูุณูุงุฑุงุช</h1>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="{% url 'add_car' %}" class="btn btn-primary">โ ุฅุถุงูุฉ ุณูุงุฑุฉ ุฌุฏูุฏุฉ</a>
        <a href="{% url 'export_cars_pdf' %}?search={{ search_query }}&status={{ status_filter }}&clearance={{ clearance_filter }}" class="btn btn-info" title="ุชุตุฏูุฑ ุฅูู PDF">๐ ุชุตุฏูุฑ PDF</a>
    </div>
</div>

<!-- Search and Filter -->
<div class="table-container mb-3">
    <form method="get" class="search-filter">
        <input type="text" name="search" id="searchInput" class="form-control" placeholder="ุงุจุญุซ ุนู ููุน ุงูุณูุงุฑุฉ ุฃู ุฑูู ุงูุดุงุตู..." value="{{ search_query }}">
        <select name="status" id="statusFilter" class="form-control">
            <option value="">ุฌููุน ุงูุญุงูุงุช</option>
            <option value="available" {% if status_filter == 'available' %}selected{% endif %}>ุบูุฑ ูุจุงุน</option>
            <option value="sold" {% if status_filter == 'sold' %}selected{% endif %}>ูุจุงุน</option>
        </select>
        <select name="clearance" id="clearanceFilter" class="form-control">
            <option value="">ุฌููุน ุงูุชุฎููุตุงุช</option>
            <option value="purchase" {% if clearance_filter == 'purchase' %}selected{% endif %}>ุดุฑุงุก</option>
            <option value="auction" {% if clearance_filter == 'auction' %}selected{% endif %}>ุฅุนูุงู</option>
        </select>
        <select name="month" id="monthFilter" class="form-control">
            <option value="">ูู ุงูุฃุดูุฑ</option>
            <option value="1" {% if month_filter == '1' %}selected{% endif %}>1 - ููุงูุฑ</option>
            <option value="2" {% if month_filter == '2' %}selected{% endif %}>2 - ูุจุฑุงูุฑ</option>
            <option value="3" {% if month_filter == '3' %}selected{% endif %}>3 - ูุงุฑุณ</option>
            <option value="4" {% if month_filter == '4' %}selected{% endif %}>4 - ุฃุจุฑูู</option>
            <option value="5" {% if month_filter == '5' %}selected{% endif %}>5 - ูุงูู</option>
            <option value="6" {% if month_filter == '6' %}selected{% endif %}>6 - ููููู</option>
            <option value="7" {% if month_filter == '7' %}selected{% endif %}>7 - ููููู</option>
            <option value="8" {% if month_filter == '8' %}selected{% endif %}>8 - ุฃุบุณุทุณ</option>
            <option value="9" {% if month_filter == '9' %}selected{% endif %}>9 - ุณุจุชูุจุฑ</option>
            <option value="10" {% if month_filter == '10' %}selected{% endif %}>10 - ุฃูุชูุจุฑ</option>
            <option value="11" {% if month_filter == '11' %}selected{% endif %}>11 - ููููุจุฑ</option>
            <option value="12" {% if month_filter == '12' %}selected{% endif %}>12 - ุฏูุณูุจุฑ</option>
        </select>
        <input type="number" name="year" id="yearFilter" class="form-control" placeholder="YYYY" value="{{ year_filter }}">
        <button type="submit" class="btn btn-primary">ุจุญุซ</button>
        <a href="{% url 'car_list' %}" class="btn btn-warning">ูุณุญ</a>
    </form>
</div>

<!-- Cars Table -->
<div class="table-container">
    {% if cars %}
    <table>
        <thead>
            <tr>
                <th>ุงุณู ุงูุณูุงุฑุฉ</th>
                <th>ููุน ุงูุณูุงุฑุฉ</th>
                <th>ุณูุฉ ุงูุตูุน</th>
                <th>ุฑูู ุงูุดุงุตู</th>
                <th>ุชุงุฑูุฎ ุงูุดุฑุงุก</th>
                <th>ูููุฉ ุงูุดุฑุงุก</th>
                <th>ุงูุชุฎููุต</th>
                <th>ุงูุญุงูุฉ</th>
                <th>ุงูุนูููุงุช</th>
            </tr>
        </thead>
        <tbody>
            {% for car in cars %}
            <tr>
                <td>{{ car.name }}</td>
                <td>{{ car.get_car_type_display }}</td>
                <td>{{ car.year }}</td>
                <td>{{ car.chassis_number }}</td>
                <td>{{ car.purchase_date|date:"d/m/Y" }}</td>
                <td>{{ car.purchase_value|floatformat:2 }}</td>
                <td>{{ car.get_clearance_type_display }}</td>
                <td>
                    {% if car.status == 'sold' %}
                        <span class="badge badge-success">โ ูุจุงุน</span>
                    {% else %}
                        <span class="badge badge-warning">ูุชุงุญ</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group">
                        <a href="{% url 'edit_car' car.id %}" class="btn btn-primary btn-small">โ๏ธ ุชุนุฏูู</a>
                        {% if car.status == 'available' %}
                            <a href="{% url 'add_sale' car.id %}" class="btn btn-success btn-small">๐ฐ ุฅุถุงูุฉ ุจูุน</a>
                        {% endif %}
                        <form method="post" action="{% url 'delete_car' car.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-small" onclick="return confirm('ูู ุฃูุช ูุชุฃูุฏุ')">๐๏ธ ุญุฐู</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-center">ูุง ุชูุฌุฏ ุณูุงุฑุงุช ูุถุงูุฉ ุญุชู ุงูุขู.</p>
    {% endif %}
</div>
{% endblock %}
